<?xml version="1.0" encoding="UTF-8"?>
<modification>
  <id>VQMOD CORE FOR OPENCART - DO NOT REMOVE</id>
  <version>1.4.x and above</version>
  <vqmver required="true">2.5.0</vqmver>
  <author>vqmod.com</author>

<!-- 在pop之前把当前的商品分类的id传给header要取子分类用 $parts[1] -->
 <file name="catalog/controller/product/category.php">
   <operation error="skip">
      <search position="after"><![CDATA[
      $parts = explode('_', (string)$this->request->get['path']);
        ]]></search>
      <add><![CDATA[
        $cur_category_id = $parts[0];
      ]]></add>
    </operation>
    <operation error="skip">
      <search position="replace"><![CDATA[
$data['header'] = $this->load->controller('common/header');
        ]]></search>
      <add><![CDATA[
         $data['header'] = $this->load->controller('common/header' , array('category_id'=>$cur_category_id));
      ]]></add>
    </operation>
  </file>

<!-- 得到分类的本身id值和当前的id判断是否相等 -->
   <file name="catalog/controller/common/header.php">
    <operation error="skip">
      <search position="replace"><![CDATA[
public function index() {
        ]]></search>
      <add><![CDATA[
       public function index($data = array()) {
      ]]></add>
    </operation>

     <operation error="skip">
          <search position="after"><![CDATA[
      'href'     => $this->url->link('product/category', 'path=' . $category['category_id'])
            ]]></search>
          <add><![CDATA[
            ,'id'       => $category['category_id']
          ]]></add>
    </operation>

    <operation error="skipr">
          <search position="after"><![CDATA[
        $data['cart'] = $this->load->controller('common/cart');
            ]]></search>
          <add><![CDATA[
              if (isset($data['category_id'])) {
          $data['sel_id'] = $data['category_id'];
        } else {
          $data['sel_id'] = 0;
        }
          ]]></add>
    </operation>

        <operation error="skip">
      <search position="after"><![CDATA[
$data['telephone'] = $this->config->get('config_telephone');
        ]]></search>
      <add><![CDATA[
          $data['firstname'] =$this->customer->getFirstName();
      ]]></add>
    </operation>

  </file>

</modification>
